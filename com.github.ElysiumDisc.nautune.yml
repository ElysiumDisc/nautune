app-id: com.github.ElysiumDisc.nautune
runtime: org.freedesktop.Platform
runtime-version: '24.08'
sdk: org.freedesktop.Sdk
command: nautune

finish-args:
  - --share=network
  - --socket=pulseaudio
  - --device=dri
  - --socket=wayland
  - --socket=fallback-x11
  # System tray support
  - --talk-name=org.kde.StatusNotifierWatcher
  - --talk-name=org.freedesktop.Notifications
  # MPRIS media controls
  - --own-name=org.mpris.MediaPlayer2.nautune

modules:
  - name: nautune
    buildsystem: simple
    build-commands:
      # Install the Flutter release bundle
      - mkdir -p /app/bin /app/lib
      - cp -r bundle/lib/* /app/lib/ || true
      - cp -r bundle/data /app/data || true
      - cp bundle/nautune /app/bin/nautune
      - chmod +x /app/bin/nautune
      # Install desktop file
      - install -Dm644 com.github.ElysiumDisc.nautune.desktop /app/share/applications/com.github.ElysiumDisc.nautune.desktop
      # Install metainfo
      - install -Dm644 com.github.ElysiumDisc.nautune.metainfo.xml /app/share/metainfo/com.github.ElysiumDisc.nautune.metainfo.xml
      # Install icons at multiple sizes
      - install -Dm644 icon.png /app/share/icons/hicolor/1024x1024/apps/com.github.ElysiumDisc.nautune.png
      - install -Dm644 icon.png /app/share/icons/hicolor/512x512/apps/com.github.ElysiumDisc.nautune.png
      - install -Dm644 icon.png /app/share/icons/hicolor/256x256/apps/com.github.ElysiumDisc.nautune.png
      - install -Dm644 icon.png /app/share/icons/hicolor/128x128/apps/com.github.ElysiumDisc.nautune.png
    sources:
      - type: dir
        path: build/linux/x64/release/bundle
        dest: bundle
      - type: file
        path: com.github.ElysiumDisc.nautune.metainfo.xml
      - type: file
        path: com.github.ElysiumDisc.nautune.desktop
      - type: file
        path: assets/icon.png
        dest-filename: icon.png
