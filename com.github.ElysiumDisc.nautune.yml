app-id: com.github.ElysiumDisc.nautune
runtime: org.freedesktop.Platform
runtime-version: '24.08'
sdk: org.freedesktop.Sdk
command: nautune

finish-args:
  - --share=network
  - --socket=pulseaudio
  - --device=dri
  - --socket=wayland
  - --socket=fallback-x11
  # System tray support
  - --talk-name=org.kde.StatusNotifierWatcher
  - --talk-name=org.freedesktop.Notifications
  # MPRIS media controls
  - --own-name=org.mpris.MediaPlayer2.nautune

modules:
  - name: nautune
    buildsystem: simple
    build-commands:
      # Install the Flutter release bundle
      - mkdir -p /app/bin /app/lib
      - cp -r bundle/lib/* /app/lib/ || true
      - cp -r bundle/data /app/data || true
      - cp bundle/nautune /app/bin/nautune
      - chmod +x /app/bin/nautune
      # Install desktop file
      - install -Dm644 com.github.ElysiumDisc.nautune.desktop /app/share/applications/com.github.ElysiumDisc.nautune.desktop
      # Install metainfo
      - install -Dm644 com.github.ElysiumDisc.nautune.metainfo.xml /app/share/metainfo/com.github.ElysiumDisc.nautune.metainfo.xml
      # Install icons â€” resize from 1024x1024 source to required sizes
      - |
        python3 -c "
        import gi
        gi.require_version('GdkPixbuf', '2.0')
        from gi.repository import GdkPixbuf
        import os
        for size in [512, 256, 128]:
            d = f'/app/share/icons/hicolor/{size}x{size}/apps'
            os.makedirs(d, exist_ok=True)
            pb = GdkPixbuf.Pixbuf.new_from_file_at_scale('icon.png', size, size, True)
            pb.savev(f'{d}/com.github.ElysiumDisc.nautune.png', 'png', [], [])
        "
    sources:
      - type: dir
        path: build/linux/x64/release/bundle
        dest: bundle
      - type: file
        path: com.github.ElysiumDisc.nautune.metainfo.xml
      - type: file
        path: com.github.ElysiumDisc.nautune.desktop
      - type: file
        path: assets/icon.png
        dest-filename: icon.png
